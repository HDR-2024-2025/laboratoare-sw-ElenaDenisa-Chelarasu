<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caută Utilizatori</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Aplicație Utilizatori</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="#" id="logoutLink">Deconectare</a>
            </div>
        </div>
    </nav>

    <div class="container mt-5">
        <div class="card">
            <div class="card-header">
                <h3 class="text-center">Căutare Utilizatori</h3>
            </div>
            <div class="card-body">
                <form id="searchForm">
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" id="searchName" placeholder="Caută după nume...">
                        <button class="btn btn-primary" type="submit">Caută</button>
                    </div>
                </form>
                <div id="searchResults" class="mt-3"></div>
            </div>
        </div>
    </div>

    <script>
        // Verifică dacă utilizatorul este autentificat
        const token = localStorage.getItem('userToken');
        if (!token) {
            window.location.href = '/login.html';
        }

        // Deconectare
        document.getElementById('logoutLink').addEventListener('click', (e) => {
            e.preventDefault();
            localStorage.removeItem('userToken');
            window.location.href = '/login.html';
        });

        document.getElementById('searchForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const searchName = document.getElementById('searchName').value;
            
            try {
                const token = localStorage.getItem('userToken');
                const response = await fetch(`/cauta?nume=${encodeURIComponent(searchName)}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.status === 401) {
                    // Token invalid, redirecționează la login
                    localStorage.removeItem('userToken');
                    window.location.href = '/login.html';
                    return;
                }

                const users = await response.json();
                
                const resultsDiv = document.getElementById('searchResults');
                resultsDiv.innerHTML = '';
                
                if (users.length === 0) {
                    resultsDiv.innerHTML = '<p>Nu s-au găsit utilizatori.</p>';
                    return;
                }

                const usersList = document.createElement('ul');
                usersList.className = 'list-group';
                
                users.forEach(user => {
                    const li = document.createElement('li');
                    li.className = 'list-group-item';
                    li.innerHTML = `
                        <div class="d-flex align-items-center">
                            ${user.profileImagePath ? 
                                `<img src="${user.profileImagePath}" class="rounded-circle me-3" style="width: 50px; height: 50px;">` : 
                                ''}
                            <div>
                                <h5>${user.displayName}</h5>
                                <p class="mb-0">${user.firstName} ${user.lastName}</p>
                            </div>
                        </div>
                    `;
                    usersList.appendChild(li);
                });
                
                resultsDiv.appendChild(usersList);
            } catch (error) {
                alert('Eroare la căutare!');
            }
        });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
</body>
</html>